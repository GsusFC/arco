var st=Object.defineProperty;var ot=(t,e,s)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var w=(t,e,s)=>ot(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();const nt=document.getElementById("app");nt.innerHTML=`
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{padding:16px}
    .note{background:#f0f9ff;border:1px solid #bae6fd;color:#0c4a6e;padding:12px;border-radius:8px}
    .actions{margin-top:12px}
  </style>
  <div class="container">
    <h1>Metaballs Editor</h1>
    <p class="note">Fase 1 lista. A continuación integraremos el SVG existente y comenzaremos la migración modular.</p>
    <div class="actions">
      <a href="svg-editor2.html" class="button">Abrir editor SVG</a>
    </div>
  </div>
`;function T(t,e,s,a,o){const r=Math.max(0,t.radius),n=Math.max(0,e.radius);if(r===0||n===0)return;const m=e.x-t.x,u=e.y-t.y,l=Math.hypot(m,u);if(l<=1e-6||l<=Math.abs(r-n))return;const y=(s==null?void 0:s.connectionFactor)??o,S=Math.max(0,Math.min(1,y/8)),A=Math.atan2(u,m),f=(tt,et,rt)=>Math.max(et,Math.min(rt,tt)),c=Math.acos(f((r-n)/l,-1,1)),b=Math.acos(f((r*r+l*l-n*n)/(2*r*l),-1,1)),p=Math.acos(f((n*n+l*l-r*r)/(2*n*l),-1,1));if(!Number.isFinite(b)||!Number.isFinite(p))return;const i=A+b+(c-b)*S,d=A-(b+(c-b)*S),g=A+Math.PI-p-(Math.PI-p-c)*S,I=A-(Math.PI-p-(Math.PI-p-c)*S),x={x:t.x+r*Math.cos(i),y:t.y+r*Math.sin(i)},C={x:t.x+r*Math.cos(d),y:t.y+r*Math.sin(d)},M={x:e.x+n*Math.cos(g),y:e.y+n*Math.sin(g)},k={x:e.x+n*Math.cos(I),y:e.y+n*Math.sin(I)},z=a,D=r+n,Y=Math.hypot(x.x-M.x,x.y-M.y);let q=Math.min(S*z,Y/D);const W=Math.min(1,l*2/(r+n));let N=q*W;(!Number.isFinite(N)||N<0)&&(N=0);const v=Math.PI/2,O=r*N,P=n*N,R={x:x.x+Math.cos(i-v)*O,y:x.y+Math.sin(i-v)*O},B={x:C.x+Math.cos(d+v)*O,y:C.y+Math.sin(d+v)*O},H={x:M.x+Math.cos(g+v)*P,y:M.y+Math.sin(g+v)*P},K={x:k.x+Math.cos(I-v)*P,y:k.y+Math.sin(I-v)*P},U=l>r+n,X=U?1:0,j=U?1:0,G=0,Z=["M",x.x,x.y,"C",R.x,R.y,H.x,H.y,M.x,M.y,"A",n,n,0,X,G,k.x,k.y,"C",K.x,K.y,B.x,B.y,C.x,C.y,"A",r,r,0,j,G,x.x,x.y,"Z"].join(" "),Q=Math.max(12,(r+n)*.3);return{pathData:Z,overlayWidth:Q}}const F="metaballs-prefs";function at(t,e){const s=`${t.gridI},${t.gridJ}`,a=`${e.gridI},${e.gridJ}`;return s<a?`${s}|${a}`:`${a}|${s}`}function L(t,e){return`metaballs-blocked-${t}x${e}`}function it(t,e,s){try{localStorage.setItem(L(e,s),JSON.stringify(Array.from(t)))}catch{}}function ct(t,e){try{const s=localStorage.getItem(L(t,e));if(s){const a=JSON.parse(s);return new Set(Array.isArray(a)?a:[])}}catch{}return new Set}function J(t,e){return`metaballs-shapes-${t}x${e}`}function lt(t,e,s){try{const a=t.map(o=>o.shape||"circle");localStorage.setItem(J(e,s),JSON.stringify(a))}catch{}}function dt(t,e,s){try{const a=localStorage.getItem(J(e,s));if(!a)return;const o=JSON.parse(a);if(!Array.isArray(o))return;for(let r=0;r<t.length&&r<o.length;r++){const n=o[r];t[r].shape=n==="square"||n==="squircle"?n:"circle"}}catch{}}function ut(){const t={local:!0,export:!0};try{const e=localStorage.getItem(F);if(e){const s=JSON.parse(e);typeof(s==null?void 0:s.local)=="boolean"&&(t.local=s.local),typeof(s==null?void 0:s.export)=="boolean"&&(t.export=s.export),typeof(s==null?void 0:s.diamond)=="boolean"&&(t.diamond=s.diamond)}}catch{}return t}function ft(t){try{localStorage.setItem(F,JSON.stringify(t))}catch{}}const E="metaballs-presets",_="metaballs-history",V=50;function ht(t,e){try{const s=$(),a={name:t.trim(),snapshot:e,created:Date.now()},o=s.findIndex(r=>r.name===a.name);o>=0?s[o]=a:s.push(a),localStorage.setItem(E,JSON.stringify(s))}catch{}}function $(){try{const t=localStorage.getItem(E);if(t){const e=JSON.parse(t);return Array.isArray(e)?e:[]}}catch{}return[]}function yt(t){try{const s=$().filter(a=>a.name!==t);localStorage.setItem(E,JSON.stringify(s))}catch{}}function gt(t){try{const e=t.slice(-V);localStorage.setItem(_,JSON.stringify(e))}catch{}}function mt(){try{const t=localStorage.getItem(_);if(t){const e=JSON.parse(t);return Array.isArray(e)?e:[]}}catch{}return[]}const pt=Object.freeze(Object.defineProperty({__proto__:null,HISTORY_KEY:_,MAX_HISTORY_SIZE:V,PREFS_KEY:F,PRESETS_KEY:E,blockedStorageKey:L,connectionKey:at,deletePreset:yt,loadBlockedLocal:ct,loadHistory:mt,loadPersistPrefs:ut,loadPresets:$,loadShapesLocal:dt,saveBlockedLocal:it,saveHistory:gt,savePersistPrefs:ft,savePreset:ht,saveShapesLocal:lt,shapesStorageKey:J},Symbol.toStringTag,{value:"Module"}));async function St(t,e,s){const{persistExportMeta:a,gridCountX:o,gridCountY:r,blockedConnections:n,maskMeta:m,shapes:u,isNodeMasked:l}=s,y=t.cloneNode(!0);if(y.querySelectorAll(".conn-overlay").forEach(i=>i.parentNode&&i.parentNode.removeChild(i)),y.setAttribute("xmlns","http://www.w3.org/2000/svg"),y.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),y.setAttribute("version","1.1"),a){const i={blockedConnections:Array.from(n),grid:{x:o,y:r}};m&&(i.mask=m),u&&(i.shapes=u);const d=document.createElementNS("http://www.w3.org/2000/svg","metadata");d.setAttribute("id","metaballs-meta"),d.textContent=JSON.stringify(i),y.insertBefore(d,y.firstChild)}const f=`<?xml version="1.0" encoding="UTF-8"?>
`+new XMLSerializer().serializeToString(y),c=new Date().toISOString().slice(0,16).replace(/[:-]/g,""),b=e.filter(i=>!i||i.isBlocked||i.from.radius<=0||i.to.radius<=0?!1:m!=null&&m.enabled&&l?!l(i.from)&&!l(i.to):!0).length,p=`metaballs-svg-editor-${o}x${r}-${b}conn-${c}.svg`;try{if("showSaveFilePicker"in window){const d=await(await window.showSaveFilePicker({suggestedName:p,types:[{description:"SVG files",accept:{"image/svg+xml":[".svg"]}}]})).createWritable();await d.write(f),await d.close(),console.log("✅ SVG descargado via File System API:",p)}else{const i=new Blob([f],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(i),g=document.createElement("a");g.href=d,g.download=p,g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d),console.log("✅ SVG descargado via método tradicional:",p)}}catch{const d="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(f);window.open(d,"_blank"),console.log("⚠️ SVG abierto en nueva ventana como fallback")}}const bt=Object.freeze(Object.defineProperty({__proto__:null,downloadSVG:St},Symbol.toStringTag,{value:"Module"}));function xt(t,e,s){const{svgNS:a="http://www.w3.org/2000/svg",editMode:o,connectionFactorMode:r,bridgeWidth:n,connectionFactor:m}=s;e.forEach((u,l)=>{if(!u||u.isBlocked||u.from.radius<=0||u.to.radius<=0)return;const y=T(u.from,u.to,u,n,m);if(!y)return;const{pathData:S,overlayWidth:A}=y,f=document.createElementNS(a,"path");f.setAttribute("d",S),f.setAttribute("fill","#ffffff"),f.setAttribute("opacity","1.0"),u.isSelected&&(f.setAttribute("stroke","#00ff00"),f.setAttribute("stroke-width","1")),t.appendChild(f);const c=document.createElementNS(a,"path");c.setAttribute("d",S),c.setAttribute("fill","none"),c.setAttribute("stroke","transparent"),c.setAttribute("stroke-width",String(A));const b=o==="connect"||r==="individual";c.setAttribute("pointer-events",b?"stroke":"none"),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("class","conn-overlay"),c.style.cursor="pointer",c.dataset.connIndex=String(l),t.appendChild(c)})}const vt="http://www.w3.org/2000/svg";function wt(t,e,s={}){const{svgNS:a=vt}=s;e.forEach(o=>{if(o.radius<=0)return;const r=document.createElementNS(a,"circle");if(r.setAttribute("cx",String(o.x)),r.setAttribute("cy",String(o.y)),r.setAttribute("r",String(o.radius)),r.setAttribute("fill","#ffffff"),r.setAttribute("opacity","1.0"),t.appendChild(r),o.isSelected){const n=document.createElementNS(a,"circle");n.setAttribute("cx",String(o.x)),n.setAttribute("cy",String(o.y)),n.setAttribute("r",String(o.radius+3)),n.setAttribute("fill","none"),n.setAttribute("stroke","#00ff00"),n.setAttribute("stroke-width","1"),n.setAttribute("opacity","1"),t.appendChild(n)}if(o.isHovered&&!o.isSelected){const n=document.createElementNS(a,"circle");n.setAttribute("cx",String(o.x)),n.setAttribute("cy",String(o.y)),n.setAttribute("r",String(o.radius+2)),n.setAttribute("fill","none"),n.setAttribute("stroke","#ffffff"),n.setAttribute("stroke-width","1"),n.setAttribute("opacity","0.8"),t.appendChild(n)}})}class At{constructor(e,s,a,o,r){w(this,"x");w(this,"y");w(this,"radius");w(this,"gridI");w(this,"gridJ");w(this,"isSelected");w(this,"isHovered");this.x=e,this.y=s,this.radius=a,this.gridI=o,this.gridJ=r,this.isSelected=!1,this.isHovered=!1}contains(e,s){const a=e-this.x,o=s-this.y;return Math.sqrt(a*a+o*o)<=Math.max(this.radius,15)}}const h=window;h.Metaballs=h.Metaballs||{};h.Metaballs.connectCirclesKuckir=T;h.Services=h.Services||{};h.Services.Persist=pt;h.Services.Exporter=bt;h.Renderer=h.Renderer||{};h.Renderer.renderConnections=xt;h.Renderer.renderCircles=wt;h.Model=h.Model||{};h.Model.Circle=At;
